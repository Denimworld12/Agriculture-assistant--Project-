(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{67:function(e,t,s){Promise.resolve().then(s.bind(s,4741)),Promise.resolve().then(s.bind(s,3e3)),Promise.resolve().then(s.t.bind(s,6168,23)),Promise.resolve().then(s.t.bind(s,6927,23)),Promise.resolve().then(s.bind(s,1770)),Promise.resolve().then(s.t.bind(s,3994,23))},1064:function(e,t,s){"use strict";var a=s(7437);s(2265),t.Z=e=>{let{className:t}=e;return(0,a.jsx)("div",{className:"rounded-full border-2 border-solid animate-spin border-t-2 border-t-secondary-900 border-linen h-6 w-6 ".concat(t||"")})}},9736:function(e,t,s){"use strict";s.d(t,{Z:function(){return Layout_LogoIcon}});var a=s(7437),l=s(8311),n=s(4741);let CustomLink=e=>{let{isExternal:t,target:s,link:l,children:n,className:o,isNavLink:i,textTransform:d,onClick:r}=e;return(0,a.jsx)("a",{target:t?"_blank":s||"_self",className:(i&&" min-w-min px-2 text-blue-800 tracking-wide font-normal text-base hover:text-red-900 ")+" ".concat(o||" block "," ").concat("uppercase"===d?" uppercase ":"capitalize"===d?" capitalize ":"  "),href:l,rel:"noopener noreferrer",onClick:r||null,children:n})};var Layout_LogoIcon=e=>{let{big:t,customLogo:s}=e;return t?(0,a.jsx)(l.kC,{isFlexOnResponsive:!0,className:"!justify-center mb-6 w-full h-full !gap-1",children:(0,a.jsx)("div",{className:"flex-none relative",children:(0,a.jsx)(n.CustomImage,{src:s||"/images/logoIcon.svg",alt:"GovAI Logo",title:"GovAI Logo",width:141,height:100})})}):(0,a.jsx)("div",{className:"block",children:(0,a.jsx)(CustomLink,{className:"block relative h-[2.5rem] w-[2.5rem]",link:"/",children:(0,a.jsx)(n.CustomImage,{src:s||"/images/logoIcon.svg",layout:"fill",objectFit:"contain",alt:"GovAI Logo",title:"GovAI Logo"})})})}},3e3:function(e,t,s){"use strict";s.r(t),s.d(t,{ChatWindow:function(){return ChatWindow}});var a=s(7437),l=s(3014);s(3343);var n=s(9251),o=s(2265),i=s(2510),d=s(586),r=s(1337),c=s(4741),u=s(6354);function ChatMessageBubble(e){return e.message.role,e.message.role,(0,a.jsx)("div",{className:" mb-4 sm:mb-6 flex flex-col gap-x-4  text-base mx-auto w-full group",children:"user"===e.message.role?(0,a.jsx)("div",{className:"flex w-full items-start  ",children:(0,a.jsxs)("div",{className:"flex items-center justify-start text-left gap-2 max-w-full sm:max-w-[80%] ",children:[(0,a.jsx)("div",{className:"flex-shrink-0 flex flex-col relative items-end",children:(0,a.jsx)("div",{className:"bg-secondary-200 bg-opacity-25 rounded-full w-10 h-10 flex items-center justify-center text-secondary-700",children:(0,a.jsx)(i.BKo,{})})}),(0,a.jsx)("div",{className:"px-4 py-3 rounded-r-2xl rounded-bl-2xl bg-secondary-200 bg-opacity-25 shadow-sm",children:(0,a.jsx)("p",{className:"flex-col gap-1 mt-0 text-sm leading-6",children:e.message.content})})]})}):(0,a.jsxs)("div",{className:"flex w-full gap-2 items-start  ",children:[(0,a.jsx)("div",{className:"flex-shrink-0 flex flex-col relative items-end h-[2rem] w-[2rem] sm:h-[2.5rem] sm:w-[2.5rem]",children:(0,a.jsx)(c.CustomImage,{src:e.customIcon?"".concat("https://cdngovai.myscheme.in/").concat(e.customIcon):"/images/logoIcon.svg",layout:"fill",alt:"".concat(e.providerName||"GovAI",' Logo"'),title:"".concat(e.providerName||"GovAI",' Logo"'),objectFit:"contain"})}),(0,a.jsxs)("div",{className:"relative flex max-w-full flex-col ",children:[(0,a.jsx)("div",{className:"markdownText  px-4 py-3  rounded-r-2xl rounded-bl-2xl bg-[#F3F4F6] shadow-sm text-sm leading-6",children:(0,a.jsx)(d.U,{children:(0,u.ns)(e.message.content)})}),(0,a.jsx)(r.Z,{copyValue:(0,u.ns)(e.message.content),messages:e.messages,domainId:e.domainId})]})]})})}function IntermediateStep(e){console.log("Intermediate step",e.message);let t=JSON.parse(e.message.content),s=t.action,l=t.observation,[n,i]=(0,o.useState)(!1);return(0,a.jsxs)("div",{className:"ml-auto bg-green-600 rounded px-4 py-2 max-w-[80%] mb-8 whitespace-pre-wrap flex flex-col cursor-pointer",children:[(0,a.jsxs)("div",{className:"text-right ".concat(n?"w-full":""),onClick:e=>i(!n),children:[(0,a.jsxs)("code",{className:"mr-2 bg-slate-600 px-2 py-1 rounded hover:text-blue-600",children:["\uD83D\uDEE0️ ",(0,a.jsx)("b",{children:s.tool})]}),(0,a.jsx)("span",{className:n?"hidden":"",children:"\uD83D\uDD3D"}),(0,a.jsx)("span",{className:n?"":"hidden",children:"\uD83D\uDD3C"})]}),(0,a.jsxs)("div",{className:"overflow-hidden max-h-[0px] transition-[max-height] ease-in-out ".concat(n?"max-h-[360px]":""),children:[(0,a.jsx)("div",{className:"bg-slate-600 rounded p-4 mt-1 max-w-0 ".concat(n?"max-w-full":"transition-[max-width] delay-100"),children:(0,a.jsxs)("code",{className:"opacity-0 max-h-[100px] overflow-auto transition ease-in-out delay-150 ".concat(n?"opacity-100":""),children:["Tool Input:",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),JSON.stringify(s.toolInput)]})}),(0,a.jsx)("div",{className:"bg-slate-600 rounded p-4 mt-1 max-w-0 ".concat(n?"max-w-full":"transition-[max-width] delay-100"),children:(0,a.jsx)("code",{className:"opacity-0 max-h-[260px] overflow-auto transition ease-in-out delay-150 ".concat(n?"opacity-100":""),children:l})})]})]})}var h=s(4026),m=s(7700),v=s(7944);s(2173);var x=s(4033),v9_Prompts=e=>{var t;let{initialMessage:s,conversationOpener:l,messages:n,onClick:o}=e;return(0,x.useSearchParams)(),(0,a.jsx)(a.Fragment,{children:((null==l?void 0:l.questions)&&0===n.length||(null==l?void 0:l.questions)&&s&&1===n.length)&&(null==l?void 0:l.questions.length)>0&&(0,a.jsx)("div",{className:"flex flex-row flex-wrap gap-2 my-2 items-center justify-between max-h-[5.5rem] sm:max-h-[7.5rem] overflow-hidden",children:null==l?void 0:null===(t=l.questions)||void 0===t?void 0:t.map((e,t)=>(0,a.jsx)("div",{onClick:()=>o(e.question),className:"flex flex-grow items-center justify-center shadow-sm cursor-pointer bg-zinc-50 text-zinc-950 rounded-2xl px-3 sm:px-4 h-[2.5rem] sm:h-[3.5rem] hover:bg-zinc-100",children:(0,a.jsx)("span",{title:e.question,className:"text-xs sm:text-sm line-clamp-1 font-medium",children:e.question})},t))})})},g=s(3498),p=s(1796),f=s(3228),w=s(9736),b=s(3164),y=s(6468),j=s(1421),C=s(1064),chat_FollowupQuestions=e=>{var t,s;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"w-full ",children:(null===(t=e.questions)||void 0===t?void 0:t.length)>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 sm:gap-3 my-2 overflow-hidden max-h-[6rem] sm:max-h-fit ",children:null===(s=e.questions)||void 0===s?void 0:s.map((t,s)=>(0,a.jsx)("div",{className:"flex justify-center items-center px-2 flex-grow rounded-lg shadow-sm border border-gray-300 cursor-pointer h-[2.5rem] ",onClick:()=>{e.onClick(t)},children:(0,a.jsx)("span",{title:t,className:"text-sm text-blue-500 line-clamp-1",children:(0,u.fm)(t)})},s))})})})},N=s(8910),S=s(3474),k=s(9213),I=s(7042),_=s(4769);function cn(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,_.m6)((0,I.W)(t))}let A=(0,k.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-slate-950 dark:focus-visible:ring-slate-300",{variants:{variant:{default:"bg-slate-900 text-slate-50 hover:bg-slate-900/90 dark:bg-slate-50 dark:text-slate-900 dark:hover:bg-slate-50/90",destructive:"bg-red-500 text-slate-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-slate-50 dark:hover:bg-red-900/90",outline:"border border-slate-200 bg-white hover:bg-slate-100 hover:text-slate-900 dark:border-slate-800 dark:bg-slate-950 dark:hover:bg-slate-800 dark:hover:text-slate-50",secondary:"bg-slate-100 text-slate-900 hover:bg-slate-100/80 dark:bg-slate-800 dark:text-slate-50 dark:hover:bg-slate-800/80",ghost:"hover:bg-slate-100 hover:text-slate-900 dark:hover:bg-slate-800 dark:hover:text-slate-50",link:"text-slate-900 underline-offset-4 hover:underline dark:text-slate-50"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),L=o.forwardRef((e,t)=>{let{className:s,variant:l,size:n,asChild:o=!1,...i}=e,d=o?S.g7:"button";return(0,a.jsx)(d,{className:cn(A({variant:l,size:n,className:s})),ref:t,...i})});L.displayName="Button";var D=s(3242),M=s(496);let z=D.fC;D.xz;let B=D.h_;D.x8;let P=o.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(D.aV,{ref:t,className:cn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...l})});P.displayName=D.aV.displayName;let R=o.forwardRef((e,t)=>{let{className:s,children:l,...n}=e;return(0,a.jsxs)(B,{children:[(0,a.jsx)(P,{}),(0,a.jsxs)(D.VY,{ref:t,className:cn("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-slate-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-slate-800 dark:bg-slate-950",s),...n,children:[l,(0,a.jsxs)(D.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-slate-100 data-[state=open]:text-slate-500 dark:ring-offset-slate-950 dark:focus:ring-slate-300 dark:data-[state=open]:bg-slate-800 dark:data-[state=open]:text-slate-400",children:[(0,a.jsx)(M.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});R.displayName=D.VY.displayName;let J=o.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(D.Dx,{ref:t,className:cn("text-lg font-semibold leading-none tracking-tight",s),...l})});J.displayName=D.Dx.displayName;let O=o.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(D.dk,{ref:t,className:cn("text-sm text-slate-500 dark:text-slate-400",s),...l})});function ChatWindow(e){var t,s;let i=(0,o.useRef)(null),[d,r]=(0,o.useState)(null);(0,o.useEffect)(()=>{(0,u.YI)().then(e=>{r(e)})},[]);let{endpoint:S,emptyStateComponent:k,showIntermediateStepsToggle:I,emoji:_,assistantData:A}=e;(0,x.useRouter)();let{updateChatSessionMessages:D,createNewChatSession:M}=(0,j.Z)(),{state:B}=(0,h.j_)(),{actions:P}=(0,h.j_)({updateAssistant:m.updateAssistant,createChatSession:m.createChatSession,setSelectedChatSession:m.setSelectedChatSession,updateChatSession:m.updateChatSession}),[Z,E]=(0,o.useState)(!1),[q,V]=(0,o.useState)(!1),[F,X]=(0,o.useState)(),[Q,G]=(0,o.useState)(!1),[U,K]=(0,o.useState)({}),[T,Y]=(0,o.useState)([]),[H,W]=(0,o.useState)([]),[$,ee]=(0,o.useState)();(0,x.useSearchParams)();let et=null==B?void 0:null===(t=B.selectedChatSession)||void 0===t?void 0:t._id,[es,ea]=(0,o.useState)(!1),el=I&&(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"checkbox",id:"show_intermediate_steps",name:"show_intermediate_steps",checked:Z,onChange:e=>E(e.target.checked)}),(0,a.jsx)("label",{htmlFor:"show_intermediate_steps",children:" Show intermediate steps"})]});function getInitialMessage(e){if(e&&Array.isArray(null==e?void 0:e.openers)&&(null==e?void 0:e.openers.length)>0){var t,s,a,l;if((null==A?void 0:null===(t=A.conversationOpeners)||void 0===t?void 0:t.random)==="Yes"){let t=Math.floor(Math.random()*(null==e?void 0:e.openers.length)),a={role:"assistant",id:(0,u.O1)(8),content:null==e?void 0:null===(s=e.openers[t])||void 0===s?void 0:s.description};W([a]),ev([a]),ee(null==e?void 0:e.openers[t])}else{let t=null==e?void 0:e.openers.filter(e=>"High"===e.priority);if(t.length>0){let e={role:"assistant",id:(0,u.O1)(8),content:null===(a=t[0])||void 0===a?void 0:a.description};W([e]),ev([e]),ee(t[0])}else{let t={role:"assistant",id:(0,u.O1)(8),content:null==e?void 0:null===(l=e.openers[0])||void 0===l?void 0:l.description};W([t]),ev([t]),ee(null==e?void 0:e.openers[0])}}}else W(void 0),ee(void 0)}let{token:en,loginStatus:eo,login:ei}=(0,g.aC)(),{messages:ed,input:er,setInput:ec,handleInputChange:eu,handleSubmit:eh,isLoading:em,setMessages:ev,stop:ex,append:eg}=(0,n.RJ)({api:S,headers:{"Content-Type":"application/json",Authorization:en&&(null==A?void 0:A.isAuthenticated)?"Bearer ".concat(en):"Basic ".concat("bXlzY2hlbWVfcmFnX3NlcnZpY2U6a2pqZ2V0dXBieDg5MDY3ODc4"),"x-api-key":"MEpg04&*@%^Vng!KL","x-fp-id":d||""},body:{app_id:null==A?void 0:A.domainId,app_type:"system",entity_id:null==A?void 0:A.orgId},onResponse(e){let t=e.headers.get("x-sources"),s=t?JSON.parse(atob(t)):[],a=e.headers.get("x-message-index");s.length&&null!==a&&K({...U,[a]:s})},onError:e=>{console.log(e.message);try{let t=JSON.parse(e.message);(0,l.Am)(null==t?void 0:t.error,{theme:"dark"})}catch(e){(0,l.Am)("Something went wrong",{theme:"dark"})}},initialMessages:H});async function sendMessage(e){if(e.preventDefault(),Y([]),i.current&&i.current.classList.add("grow"),ed.length||await new Promise(e=>setTimeout(e,300)),null!=em?!em:!Q){if(Z){G(!0),ec("");let e=ed.concat({id:ed.length.toString(),content:er,role:"user"});ev(e);let s=new Headers;s.append("x-api-key","MEpg04&*@%^Vng!KL"),s.append("x-fp-id",d||"");let a=await fetch(S,{method:"POST",body:JSON.stringify({messages:e,show_intermediate_steps:!0}),headers:s}),n=await a.json();if(G(!1),200===a.status){var t;let s=(null!==(t=n.intermediate_steps)&&void 0!==t?t:[]).map((t,s)=>({id:(e.length+s).toString(),content:JSON.stringify(t),role:"system"}));for(let t of s)e.push(t),ev([...e]),await new Promise(e=>setTimeout(e,1e3+1e3*Math.random()));ev([...e,{id:(e.length+s.length).toString(),content:n.output,role:"assistant"}])}else if(n.error)throw(0,l.Am)(n.error,{theme:"dark"}),Error(n.error)}else eh(e)}}let ep=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(A){var e,t;P.updateAssistant(A),(null==B?void 0:B.selectedChatSession)&&(null==B?void 0:null===(e=B.selectedChatSession)||void 0===e?void 0:e.messages.length)>1&&et?(Y([]),ev(null==B?void 0:null===(t=B.selectedChatSession)||void 0===t?void 0:t.messages)):(ev([]),Y([]),getInitialMessage(null==A?void 0:A.conversationOpeners))}},[A,et]),(0,o.useEffect)(()=>(!em&&ed.length>0&&(ed.filter(e=>"user"===e.role),et&&(null==A?void 0:A.saveHistory)&&("loggedIn"===eo?D(et,ed):P.updateChatSession({id:et,messages:ed}))),()=>{ep.current&&ep.current.cancel("Component unmounted, request canceled")}),[null==ed?void 0:ed.length,em]);let[ef,ew]=(0,o.useState)("showLoading");(0,o.useEffect)(()=>{var e;(null==A?void 0:null===(e=A.status)||void 0===e?void 0:e.toLowerCase())==="active"?(null==A?void 0:A.isAuthenticated)===!0&&"loggedOut"===eo?ew("showLogin"):A?ew("showChat"):ew("showLoading"):ew("showNotActive")},[A]);let showRestChat=()=>!q&&!!$&&ed.length>1||!q&&ed.length>1,[eb,ey]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let handleMessage=e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.action)==="handelCloseBotIcon"&&(console.log("Closing Bot"),ey(!0))};return window.addEventListener("message",handleMessage,!1),()=>{window.removeEventListener("message",handleMessage)}},[]);let handelResetChat=()=>{var e;ev(H||[]),Y([]),null==ep||null===(e=ep.current)||void 0===e||e.cancel("Reset chat"),P.setSelectedChatSession(null)};return(0,a.jsxs)("div",{className:"flex h-full flex-col items-center rounded grow text-base mx-auto gap-3 lg:px-1 group",children:[(0,a.jsx)(z,{open:eb,onOpenChange:ey,children:(0,a.jsxs)(R,{children:[(0,a.jsx)(N.eJU,{className:"text-center text-red-500",size:30}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(J,{className:"dark:text-white leading-6",children:"Are you sure you want to end the chat session?"}),(0,a.jsx)(O,{className:"mb-2",children:"This will reset the chat and clear all messages."})]}),(0,a.jsxs)("div",{className:"flex flex-row justify-end items-center gap-2 ",children:[(0,a.jsx)(L,{variant:"secondary",onClick:()=>ey(!1),children:"No"}),(0,a.jsx)(L,{type:"submit",onClick:()=>{window.parent.postMessage({action:"handelCloseBotModal"},"*"),handelResetChat(),ey(!1)},children:"Yes"})]})]})}),"showLoading"!==ef&&"loading"!==eo||q?(0,a.jsxs)(a.Fragment,{children:["showChat"===ef&&!q&&(0,a.jsxs)("div",{className:"flex w-full h-full flex-col md:max-w-3xl mx-auto",children:[(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex flex-1 ".concat(void 0===ed.find(e=>(null==e?void 0:e.role)==="user")?"flex-col":"flex-col-reverse"," w-full mb-4 overflow-auto no-scrollbar transition-[flex-grow] ease-in-out"),ref:i,children:void 0!==ed.find(e=>(null==e?void 0:e.role)==="user")?[...ed].reverse().map((e,t)=>{let s=(ed.length-1-t).toString();return"system"===e.role?(0,a.jsx)(IntermediateStep,{message:e},t):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(ChatMessageBubble,{message:e,aiEmoji:_,sources:U[s],providerName:null==A?void 0:A.displayName,customIcon:null==A?void 0:A.icon,messages:ed,domainId:(null==A?void 0:A.domainId)||""},t)})}):(0,a.jsxs)("div",{className:"flex flex-col gap-2 rounded-2xl bg-zinc-50 sm:p-8 p-4 text-sm sm:text-base mt-4",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl tracking-tight font-semibold max-w-fit inline-block",children:null==A?void 0:A.displayName}),(0,a.jsx)("p",{className:"leading-normal text-zinc-900",children:null==A?void 0:A.description}),(0,a.jsx)("p",{className:"leading-normal text-zinc-900",children:H?null===(s=H[0])||void 0===s?void 0:s.content:""})]})}),es&&ed.length>1&&(0,a.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,a.jsx)(C.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs text-secondary-text",children:"Loading followup questions..."})]})]}),(0,a.jsx)(chat_FollowupQuestions,{questions:T,onClick:e=>{eg({role:"user",content:e}),Y([])}}),(0,a.jsx)("div",{className:"pt-2 md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent",children:(0,a.jsx)("form",{onSubmit:async e=>{!et&&(null==A?void 0:A.domainId)&&(null==A?void 0:A.saveHistory)&&await M({domainId:null==A?void 0:A.domainId}),sendMessage(e)},className:"stretch mx-0 flex flex-row gap-3 last:mb-2 md:last:mb-6",children:(0,a.jsxs)("div",{className:"relative flex h-full flex-1 items-stretch flex-col overflow-hidden",children:[(0,a.jsx)("div",{className:"flex",children:el}),(0,a.jsxs)("div",{className:"flex relative w-full flex-col",children:[A&&(0,a.jsx)(v9_Prompts,{onClick:async e=>{!et&&(null==A?void 0:A.saveHistory)&&await M({domainId:null==A?void 0:A.domainId});let t=(0,u.O1)(8);eg({role:"user",content:e,id:t})},messages:ed,initialMessage:H||null,conversationOpener:$||null}),(0,a.jsx)(v.Z,{intermediateStepsLoading:Q,chatEndpointIsLoading:em,showRestChat,value:er,onChange:eu,onClickStop:ex,handelSubmit:async e=>{!et&&(null==A?void 0:A.domainId)&&(null==A?void 0:A.saveHistory)&&await M({domainId:null==A?void 0:A.domainId}),sendMessage(e)},providerName:null==A?void 0:A.displayName,onResetChat:handelResetChat})]})]})})}),(0,a.jsx)(l.Ix,{})]}),"showLogin"===ef&&!q&&(0,a.jsxs)("div",{className:"h-[80vh] w-full flex flex-col items-center justify-center",children:[(0,a.jsx)(p.Z,{title:"Please login to continue"}),(0,a.jsx)(b.o,{iconBtn:!0,icon:y.SZ3,iconSize:10,onClick:()=>ei(),className:"flex flex-row items-center",darkBtn:!0,iconClass:"h-4 w-4",children:"Login"})]}),("showNotActive"===ef||q)&&(0,a.jsxs)("div",{className:"flex w-full h-full flex-col md:max-w-3xl mx-auto",children:[(0,a.jsxs)("div",{className:"w-full flex-1 flex flex-col items-center  mb-4 justify-center",children:[(null==A?void 0:A.logo)?(0,a.jsx)(c.CustomImage,{src:"".concat("https://cdngovai.myscheme.in/").concat(null==A?void 0:A.logo),alt:"".concat(null==A?void 0:A.displayName," Logo"),height:200,width:200,className:"mb-4"}):(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(w.Z,{})}),(0,a.jsx)("h1",{className:" text-center text-lg leading-tight mb-0",children:F||"Sorry! Chatbot can not be used right now."}),(0,a.jsx)("p",{className:"m-0 mt-2 text-sm text-gray-500 text-center",children:"We are enhancing the chatbot to return better answers. Please try again later."})]}),(0,a.jsx)("div",{className:"pt-2 md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent",children:(0,a.jsx)("form",{onSubmit:sendMessage,className:"stretch mx-0 flex flex-row gap-3 last:mb-2 md:last:mb-6",children:(0,a.jsxs)("div",{className:"relative flex h-full flex-1 items-stretch md:flex-col",children:[(0,a.jsx)("div",{className:"flex",children:el}),(0,a.jsx)("div",{className:"flex relative w-full flex-col",children:(0,a.jsx)(v.Z,{disabled:!0,intermediateStepsLoading:Q,chatEndpointIsLoading:em,showRestChat,value:er,onChange:eu,onClickStop:ex,handelSubmit:sendMessage,providerName:null==A?void 0:A.displayName,onResetChat:handelResetChat})})]})})}),(0,a.jsx)(l.Ix,{})]})]}):(0,a.jsx)(f.Z,{loading:!0})]})}O.displayName=D.dk.displayName},1421:function(e,t,s){"use strict";var a=s(3498),l=s(2173),n=s(4026),o=s(2265),i=s(7700),d=s(4033),r=s(7350),c=s(3014);t.Z=()=>{let[e,t]=(0,o.useState)(!1),{token:s,loginStatus:u}=(0,a.aC)(),{state:h}=(0,n.j_)(),{actions:m}=(0,n.j_)({createChatSession:i.createChatSession,saveChatSessions:i.saveChatSessions,setSelectedChatSession:i.setSelectedChatSession,deleteChatSession:i.deleteChatSession,updateChatSession:i.updateChatSession}),v=(0,d.useRouter)(),x=(0,d.useSearchParams)(),generateChatSessionID=async e=>{var a,n;let{domainId:o,title:i="Untitled"}=e;t(!0);let d=await l.Z.post("".concat("https://api.myscheme.gov.in/studio/v1/chat-history"),{domainId:o,title:i,messages:[]},{headers:{"x-api-key":"ICdhCnhQ4b8mnlvs2J4JV7BKdqQXL9cG62Xsc6UD",Authorization:"Bearer ".concat(s)}});if(200!==d.status||(null===(a=d.data)||void 0===a?void 0:a.statusCode)!==200)return t(!1),{sessionId:null,error:d};{let e=null==d?void 0:null===(n=d.data)||void 0===n?void 0:n.data;return t(!1),m.createChatSession({domainId:null==e?void 0:e.domainId,_id:null==e?void 0:e._id}),{sessionId:null==e?void 0:e._id,error:null}}},createNewChatSession=async e=>{let{domainId:t,title:s="Untitled"}=e;if("loggedIn"===u){let e=await generateChatSessionID({domainId:t,title:s});await getSavedChats({domainId:t}),(null==e?void 0:e.sessionId)?x.get("isEmbed")?v.push("/".concat(t,"?sessionId=").concat(null==e?void 0:e.sessionId,"&isEmbed=true")):v.push("/".concat(t,"?sessionId=").concat(null==e?void 0:e.sessionId)):(0,c.Am)("Something went wrong! Please try again later",{theme:"dark"})}else{let e=(0,r.x0)();m.createChatSession({domainId:t,_id:e})}},getSavedChats=async e=>{let{currentPage:t=1,limit:a=10,domainId:n}=e,o=encodeURIComponent(JSON.stringify({domainId:n}));return await l.Z.get("".concat("https://api.myscheme.gov.in/studio/v1/chat-history","?page=").concat(t,"&limit=").concat(a,"&filters=").concat(o),{headers:{"x-api-key":"ICdhCnhQ4b8mnlvs2J4JV7BKdqQXL9cG62Xsc6UD",Authorization:"Bearer ".concat(s)}}).then(e=>{var t,s,a,l,n;(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.statusCode)===200&&(null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.results)&&m.saveChatSessions(null===(n=e.data)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l.results.map(e=>({...e,messages:[]})))}).catch(e=>{(0,c.Am)("Something went wrong! Please try again later",{theme:"dark"})})},getChatSessionData=async(e,t)=>{if(!s){var a;let s=null==h?void 0:null===(a=h.savedChatSessions)||void 0===a?void 0:a.find(t=>(null==t?void 0:t._id)===e);return m.setSelectedChatSession(s),v.push("/".concat(t))}return l.Z.get("".concat("https://api.myscheme.gov.in/studio/v1/chat-history","/").concat(e),{headers:{"x-api-key":"ICdhCnhQ4b8mnlvs2J4JV7BKdqQXL9cG62Xsc6UD",Authorization:"Bearer ".concat(s)}}).then(e=>{var t,s,a,l,n;(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.statusCode)===200&&(null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.data)&&(m.setSelectedChatSession(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.data),v.push("/".concat(null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l.domainId)))}).catch(e=>{(0,c.Am)("Something went wrong! Please try again later",{theme:"dark"})})},deleteChatSessionData=async(e,t)=>{var a,n;let o=(null===(a=h.savedChatSessions)||void 0===a?void 0:a.filter(t=>t._id!==e))||[];return s?l.Z.delete("".concat("https://api.myscheme.gov.in/studio/v1/chat-history","/").concat(e),{headers:{"x-api-key":"ICdhCnhQ4b8mnlvs2J4JV7BKdqQXL9cG62Xsc6UD",Authorization:"Bearer ".concat(s)}}).then(async s=>{var a,l,n;(null==s?void 0:null===(a=s.data)||void 0===a?void 0:a.statusCode)===200&&(null==s?void 0:null===(l=s.data)||void 0===l?void 0:l.data)&&(m.deleteChatSession(e),(null==o?void 0:o.length)>0?await getChatSessionData(null===(n=o[0])||void 0===n?void 0:n._id,t):v.push("/"))}).catch(e=>{(0,c.Am)("Something went wrong! Please try again later",{theme:"dark"})}):(m.deleteChatSession(e),(null==o?void 0:o.length)>0)?await getChatSessionData(null===(n=o[0])||void 0===n?void 0:n._id,t):v.push("/")},addNewMessages=async(e,t)=>l.Z.patch("".concat("https://api.myscheme.gov.in/studio/v1/chat-history","/").concat(e),{messages:t},{headers:{"x-api-key":"ICdhCnhQ4b8mnlvs2J4JV7BKdqQXL9cG62Xsc6UD",Authorization:"Bearer ".concat(s)}}).then(t=>{var s,a,l;(null==t?void 0:null===(s=t.data)||void 0===s?void 0:s.statusCode)===200&&(null==t?void 0:null===(a=t.data)||void 0===a?void 0:a.data)&&m.updateChatSession({id:e,messages:null===(l=t.data.data)||void 0===l?void 0:l.messages})}).catch(e=>{(0,c.Am)("Something went wrong! Please try again later",{theme:"dark"})}),updateChatSessionMessages=async(e,t)=>{var s;if(!Array.isArray(t))throw Error("Messages should be an array");let a=(null===(s=h.selectedChatSession)||void 0===s?void 0:s.messages)||[],l=t.filter(e=>!a.some(t=>t.content===e.content&&t.role===e.role)),n=l.map(t=>addNewMessages(e,{content:t.content,role:t.role}));try{let e=await Promise.all(n);return e}catch(e){throw(0,c.Am)("Something went wrong with one or more updates! Please try again later",{theme:"dark"}),e}},updateSessionTitle=async(e,t)=>s?l.Z.patch("".concat("https://api.myscheme.gov.in/studio/v1/chat-history","/").concat(e),{title:t},{headers:{"x-api-key":"ICdhCnhQ4b8mnlvs2J4JV7BKdqQXL9cG62Xsc6UD",Authorization:"Bearer ".concat(s)}}).then(t=>{var s,a,l;(null==t?void 0:null===(s=t.data)||void 0===s?void 0:s.statusCode)===200&&(null==t?void 0:null===(a=t.data)||void 0===a?void 0:a.data)&&m.updateChatSession({id:e,title:null===(l=t.data.data)||void 0===l?void 0:l.title})}).catch(e=>{(0,c.Am)("Something went wrong! Please try again later",{theme:"dark"})}):m.updateChatSession({id:e,title:t});return{loading:e,createNewChatSession,getSavedChats,getChatSessionData,deleteChatSessionData,updateChatSessionMessages,updateSessionTitle}}}},function(e){e.O(0,[420,582,190,169,306,33,603,173,114,713,922,125,538,971,472,744],function(){return e(e.s=67)}),_N_E=e.O()}]);